<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
    </head>
    <body>       
        <canvas id="canvas" style="border-width: 1px; border-style: solid;"></canvas>

        <script type="text/javascript" src="js/tetrix_model.js"></script>
        <script type="text/javascript" src="js/tetrix_view.js"></script>
        <script type="text/javascript">
            const blockWidth = 25;
            const boxWidth = 100;
            const boxHeight = 100;
            const groundBlocksX = 10;
            const groundBlocksY = 20;

            var images = [];
            for(var i = 0; i < 7; i++) {
                images[i] = new Image();
                images[i].src = 'images/' + (i + 1) + '.jpg';
            }

            let canvas = document.createElement('canvas');
            canvas.width = boxWidth;
            canvas.height = boxHeight;        
            var tetrixBox = new TetrixBox(images, canvas);
            tetrixBox.backgroundColor = rgb(0, 0, 0);
    
            let piece = randomFreezePiece();

            var tetrixGround = new TetrixGround(groundBlocksX, groundBlocksY);
            tetrixGround.addPieceOfType(piece.type);

            var canvas1 = document.getElementById('canvas');
            canvas1.width = groundBlocksX * blockWidth;
            canvas1.height = groundBlocksY * blockWidth;
            
            var stackArea = new TetrixStackArea(images, blockWidth, tetrixGround);
            
            var context = canvas1.getContext('2d');
            
            setTimeout(function() {
                if(tetrixGround.isMovable(0, 1)) {
                    tetrixGround.moveTetrixRight();
                    tetrixGround.moveTetrixDown();
                    tetrixGround.rotateTetrix(true);
                    tetrixGround.updateGround();
                    stackArea.paint(context);
                }
                else {
                    tetrixGround.addPieceOfType(piece.type);
                    piece = randomFreezePiece();
                }
                
                if(!tetrixGround.isGameover) {
                    setTimeout(arguments.callee, 100);
                } else {
                    stackArea.paint(context);
                }
            }, 100);

        </script>        
    </body>
</html>